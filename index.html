<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Tycoon Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        body { background: #05070a; color: white; font-family: sans-serif; margin: 0; padding: 0; text-align: center; overflow: hidden; }
        
        /* Sayfa DÃ¼zeni */
        .page { display: none; padding: 20px; height: 82vh; overflow-y: auto; flex-direction: column; align-items: center; }
        .active { display: flex; }

        /* Puan ve Buton */
        #score { font-family: 'Orbitron'; font-size: 45px; color: #00f2ff; margin: 25px 0; text-shadow: 0 0 10px #00f2ff; }
        .brain { width: 160px; height: 160px; border-radius: 50%; background: #1a103d; border: 3px solid #7000ff; font-size: 70px; cursor: pointer; transition: 0.1s; box-shadow: 0 0 20px #7000ff; margin-bottom: 20px; }
        .brain:active { transform: scale(0.9); }

        /* Kartlar */
        .card { width: 90%; background: #0d1117; border: 1px solid #1a2236; border-radius: 12px; padding: 15px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center; }
        .btn { background: #00f2ff; color: #000; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        /* Alt MenÃ¼ */
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #0d1117; border-top: 1px solid #1a2236; padding: 15px 0; }
        .nav-item { flex: 1; font-size: 11px; font-weight: bold; color: #4b5563; cursor: pointer; }
        .nav-item.active-nav { color: #00f2ff; }
    </style>
</head>
<body>

    <div id="home" class="page active">
        <div id="score">0</div>
        <button class="brain" onclick="tap()">ðŸ§ </button>
        <button onclick="spin()" style="background:gold; color:black; border:none; padding:12px; border-radius:10px; font-weight:bold; width:80%;">ðŸŽ¡ ÅžANSLI Ã‡ARK</button>
        <div id="status" style="margin-top:15px; font-size:10px; color:#4b5563;">MB Bulutuna BaÄŸlanÄ±yor...</div>
    </div>

    <div id="market" class="page">
        <h2 style="font-family:Orbitron; color:#00f2ff">TEKNOLOJÄ° MARKETÄ°</h2>
        <div class="card"><div><b>RTX 5090</b><br><small>+5 TÄ±k GÃ¼cÃ¼</small></div><button class="btn" onclick="buy('tap', 5000, 5)">5K</button></div>
        <div class="card"><div><b>AI Sunucu</b><br><small>+50 Pasif/s</small></div><button class="btn" onclick="buy('pas', 20000, 50)">20K</button></div>
        <div class="card"><div><b>Kuantum Ã‡ip</b><br><small>+200 Pasif/s</small></div><button class="btn" onclick="buy('pas', 100000, 200)">100K</button></div>
    </div>

    <div id="rank" class="page">
        <h2 style="font-family:Orbitron; color:#00f2ff">GLOBAL LÄ°DERLER</h2>
        <div id="rank-list" style="width:100%">MacBook'tan veriler alÄ±nÄ±yor...</div>
    </div>

    <div class="nav">
        <div id="n-home" class="nav-item active-nav" onclick="show('home')">ANA SAYFA</div>
        <div id="n-market" class="nav-item" onclick="show('market')">MARKET</div>
        <div id="n-rank" class="nav-item" onclick="show('rank')">SIRALAMA</div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        // SENÄ°N NGROK LÄ°NKÄ°N
        const SERVER_URL = "https://epistemically-unconcealing-theda.ngrok-free.dev";

        let score = 0, tapPower = 1, pasIncome = 0;
        let user = tg.initDataUnsafe.user || { id: "test_dev", first_name: "Boss" };

        async function init() {
            try {
                const res = await fetch(`${SERVER_URL}/login`, { 
                    method: 'POST', 
                    headers: {'Content-Type': 'application/json'}, 
                    body: JSON.stringify({ user_id: user.id.toString(), username: user.first_name }) 
                });
                const data = await res.json();
                score = data.score || 0;
                tapPower = data.tap || 1;
                pasIncome = data.pas || 0;
                updateUI();
                document.getElementById('status').innerText = "âœ… MacBook Cloud: AKTÄ°F";
            } catch(e) { document.getElementById('status').innerText = "âŒ Sunucu BaÄŸlantÄ± HatasÄ±"; }
        }

        function tap() { 
            score += tapPower; 
            updateUI(); 
            tg.HapticFeedback.impactOccurred('medium'); 
        }

        async function spin() {
            try {
                const res = await fetch(`${SERVER_URL}/spin`, { 
                    method: 'POST', 
                    headers: {'Content-Type': 'application/json'}, 
                    body: JSON.stringify({ user_id: user.id.toString() }) 
                });
                const data = await res.json();
                if(data.status === 'success') {
                    score = data.new_score;
                    updateUI();
                    tg.showAlert(`ðŸŽ¡ Tebrikler! ${data.win} MB kazandÄ±n!`);
                } else { tg.showAlert("GÃ¼nde sadece 1 kez Ã§evirebilirsin!"); }
            } catch(e) { tg.showAlert("Sunucu hatasÄ±!"); }
        }

        function buy(type, cost, bonus) {
            if(score >= cost) {
                score -= cost;
                if(type==='tap') tapPower += bonus; else pasIncome += bonus;
                updateUI();
                save();
            } else { tg.showAlert("Yetersiz MB!"); }
        }

        async function loadRank() {
            try {
                const res = await fetch(`${SERVER_URL}/leaderboard`);
                const list = await res.json();
                document.getElementById('rank-list').innerHTML = list.map((p, i) => `
                    <div class="card"><span>#${i+1} ${p.username}</span><b>${Math.floor(p.score).toLocaleString()}</b></div>
                `).join('');
            } catch(e) { document.getElementById('rank-list').innerHTML = "SÄ±ralama yÃ¼klenemedi."; }
        }

        async function save() {
            try {
                await fetch(`${SERVER_URL}/save`, { 
                    method: 'POST', 
                    headers: {'Content-Type': 'application/json'}, 
                    body: JSON.stringify({ 
                        user_id: user.id.toString(), 
                        score: score, 
                        tap: tapPower, 
                        pas: pasIncome 
                    }) 
                });
            } catch(e) {}
        }

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(score).toLocaleString();
        }

        function show(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav'));
            document.getElementById(id).classList.add('active');
            document.getElementById('n-'+id).classList.add('active-nav');
            if(id === 'rank') loadRank();
        }

        setInterval(() => { if(pasIncome > 0) { score += (pasIncome/10); updateUI(); } }, 100);
        setInterval(save, 15000);
        init();
    </script>
</body>
</html>
